title=É um PostgreSQL! Não, é um MSSql! Não, é um DB2! [h2 modo compatibilidade]
date=2012-05-18
type=post
tags=banco-de-dados,java,maven
status=published
~~~~~~

<p><br />Calma pessoal, é apenas o banco <a href="http://www.h2database.com/html/features.html#compatibility" target="_blank">H2 em modo compatibilidade</a>! Imagine <br />que você acabou levando trabalho pra casa (Novidade!!!) mas se <br />esqueceu que em casa vc não possui o ambiente - banco de dados - <br />desenvolvimento semelhante ao do trabalho. Em meu caso um servidor de <br />banco de dados PostgreSQL.<br /></p><br /><p><br />O que isso tem haver com <a href="http://www.h2database.com/html/main.html" target="_blank">o banco de dados H2</a>? Diferentemente de um <br />Postgresql, um MS Sql ou Oracle o H2 é um banco de dados leve e de <br />fácil instalação, podendo até executá-lo sem a necessidade de uma <br />instalação propriamente dita.<br /><h2>Mas como isso funciona?</h2><br /></p><br /><p><br />Há dua formas de se beneficiar desta característia. A primeira é <br />utilizar o driver jdbc do próprio H2, utilizando o parâmetro MODE na <br />URL de conexão:<br /><pre lang="bash"><br />jdbc:h2:file:data/teste;create=true;MODE=PostgreSQL;DB_CLOSE_DELAY=-1<br /></pre><br /><br />Assim você poderia recriar as estruturas do banco por script ou <br />ativando a criação das entidades no provedor de persistência - caso <br />utilize JPA. Veja que as estruturas - tabelas, views, sequências, etc <br />- não teriam que ser ajustadas por estar utilizando o H2. O banco H2 <br />entende o dialeto, por assim dizer, do banco a ser "emulado" pelo <br />parâmetro MODE.<br /></p><br /><p><br />A segunda maneira, por sinal mais interessante, é não fazer nada! <br />Como assim? Você provavelmente se questiona! É verdade, você não <br />mexe em nada do seu projeto - que é um banco específico, no meu caso o <br />PostgreSQL. Você continua utlizando o driver, a URL do seu banco e <br />deixa o H2 fazer o resto. Vamos ver?<br />Suponha que sua forma de conexão seja a seguinte:<br /><pre lang="xml"><br /><dependencies><br />	<dependency><br />		<groupId>postgresql</groupId><br />		<artifactId>postgresql</artifactId><br />		<version>8.1-408.jdbc3</version><br />	</dependency><br /></dependencies><br /><properties><br />	<!-- Default Database Connection--><br />	<jdbc.url>jdbc:postgresql://localhost:5435/teste</jdbc.url><br />	<jdbc.driverClassName>org.postgresql.Driver</jdbc.driverClassName><br />	<jdbc.username>teste</jdbc.username><br />	<jdbc.password>teste</jdbc.password><br /></properties><br /></pre><br /></p><br /><p><br />Para funcionar precisamos ter um servidor PostreSQL rodando <br />localmente, certo? Pois bem, vamos iniciar e estabelecer um servidor <br />PostgreSQL através do H2. Para facilitar as coisas, vamos criar <a href="http://www.manydesigns.com/documentation/tutorials/using-maven-profiles-and-resource-filtering.html" target="_blank">um <br />profile</a> que nos auxiliará nesta tarefa:<br /><pre lang="xml"><br /><profiles><br /><profile><br />	<id>h2</id><br />	<activation><br />		<activeByDefault>false</activeByDefault><br />	</activation><br />	<dependencies><br />		<dependency><br />			<groupId>postgresql</groupId><br />			<artifactId>postgresql</artifactId><br />			<version>8.1-408.jdbc3</version><br />		</dependency><br />		<dependency><br />			<groupId>com.h2database</groupId><br />			<artifactId>h2</artifactId><br />			<version>1.3.166</version><br />		</dependency><br />	</dependencies><br /></profile><br /></profiles><br /></pre><br />Agora a "grande sacada" do H2, abra dois terminais: um para rodar o <br />servidor e a outra para você trabalhar normalmente com o maven. Em uma <br />delas iremos iniciar o servidor:<br /><pre lang="bash"><br />mvn -P h2 exec:java -Dexec.mainClass="org.h2.tools.Server" -Dexec.args="-properties data -baseDir data"<br /></pre><br /></p><br /><p><br />Após este comando, você terá a sua disposição uma interface - via <br />navegador - a qual lhe permitirá escolher em qual MODE rodar o <br />servidor.<br />[caption id="attachment_899" align="alignleft" width="547" caption="H2 Admin Interface"]<a href="http://blog.gilbertoca.com/wp-content/uploads/H2_admin_interface.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/H2_admin_interface.png" alt="" title="H2_admin_interface" width="547" height="675" class="size-full wp-image-899" /></a>[/caption]<br />Ao conectar àquela configuração definida incialmente, teremos outra <br />interface de administração. Aqui poderemos administrar nosso "banco <br />PostgreSQL"<br /><br />[caption id="attachment_903" align="alignleft" width="825" caption="H2 Admin Console"]<a href="http://blog.gilbertoca.com/wp-content/uploads/H2_admin_interface_PG_MODE.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/H2_admin_interface_PG_MODE.png" alt="" title="H2_admin_interface_PG_MODE" width="825" height="831" class="size-full wp-image-903" /></a>[/caption]<br />Acesse este banco por sua aplicação ou por qualquer outro cliente <br />jdbc - por exemplo o squirrel. Lembre-se você estará acessando um <br />banco PostgreSQL!<br />