title=Linux - Participação no domínio do Windows
date=2011-07-16
type=post
tags=opensuse,configuracao,sistema-operacional,kerberos,active-directory
status=published
~~~~~~

<blockquote>Eu não quero compartilhar aquivo nenhum, apenas quero me logar no dominio MS, para assim usar internet, e-mail, enfim tudo que uma estação d trabalho com XP faria quando ngressa no dominio!<br />Eu não quero criar um server com samba sem ser PDC E deixar na rede, quero apenas ao inves de usar o XP como estação de trabalho usar o openSUSE!<br /></blockquote><br /><p><br />Este pedido de ajuda está registrado <a href="http://www.vivaolinux.com.br/topico/Suse/Linux-em-dominio-Windows" title="Linux em dominio Windows" target="_blank">aqui</a> na comunidade <a href="http://www.vivaolinux.com.br/" title="Viva o Linux" target="_blank">vivaolinux</a>.<br /></p><br /><p><br />Apesar de ser uma discussão antiga, ainda assim é bom fazer um passo a passo deste procedimento. Antes devo relatar que aqui na secretaria usamos <a href="http://technet.microsoft.com/pt-br/library/cc668412.aspx" title="Active Directory" target="_blank">Active Directory</a> para autenticação, então foi esse ambiente que usei para testar a inclusão de uma estação <a href="http://pt.opensuse.org/Portal:Distribui%C3%A7%C3%A3o" title="OpenSUSE" target="_blank">Linux OpenSUSE</a> em um Domínio Windows:<br /></p><br /><ol><br />	<li>Registrar seu controlador de domínio(DC) na lista de nomes de máquinas. Adicione todo o nome qualificado primeiro e o apelido como alias: 192.168.1.2 = server.domain.com server<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/1-register_domain_controler_machine_hosts.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/1-register_domain_controler_machine_hosts.png" alt="" title="1-register_domain_controler_machine_hosts" width="1024" height="768" class="alignright size-full wp-image-769" /></a><br /></li><br />	<li>Editar o arquivo /etc/resolv.conf e adicionar seu DC como nameserver: nameserver = server.domain.com<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/2-edit_etc_resolver_conf_add_DC_as_nameserver.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/2-edit_etc_resolver_conf_add_DC_as_nameserver.png" alt="" title="2-edit_etc_resolver_conf_add_DC_as_nameserver" width="1024" height="768" class="alignright size-full wp-image-770" /></a><br /></li><br />	<li>Configure o kerberos através do yast: o realm deverá ser escrito em letra maiúscula: DOMAIN.COM<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/3-configure_kerberos_capitalletters_for_DC.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/3-configure_kerberos_capitalletters_for_DC.png" alt="" title="3-configure_kerberos_capitalletters_for_DC" width="1024" height="768" class="alignright size-full wp-image-771" /></a><br /></li><br />	<li>Configura o samba<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/4-samba_DC_none_workgroupname_domain_security_ads_realms.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/4-samba_DC_none_workgroupname_domain_security_ads_realms.png" alt="" title="4-samba_DC_none_workgroupname_domain_security_ads_realms" width="1024" height="768" class="alignright size-full wp-image-772" /></a><br /><pre lang="vim"><br />SUGEP265338:~ # more /etc/samba/smb.conf <br /># smb.conf is the main Samba configuration file. You find a full commented<br /># version at /usr/share/doc/packages/samba/examples/smb.conf.SUSE if the<br /># samba-doc package is installed.<br /># Date: 2011-11-02<br />[global]<br />	add machine script = /usr/sbin/useradd -c Machine -d /var/lib/nobody -s /bin/false %m$<br />	domain master = No<br />	security = ADS<br />	workgroup = ADMINISTRACAO<br />	realm = ADMINISTRACAO.LOCAL<br />	idmap gid = 10000-20000<br />	idmap uid = 10000-20000<br />	usershare allow guests = No<br />	template homedir = /home/%D/%U<br />	winbind refresh tickets = yes<br />	template shell = /bin/bash<br />[homes]<br />	comment = Home Directories<br />	valid users = %S, %D%w%S<br />	browseable = No<br />	read only = No<br />	inherit acls = Yes<br />[profiles]<br />--More--(51%)<br /><br /></pre><br />Não esqueça de reiniciar os serviços<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/5-restart_samba_server.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/5-restart_samba_server.png" alt="" title="5-restart_samba_server" width="1024" height="768" class="alignright size-full wp-image-773" /></a><br /></li><br />	<li>Adicionar a máquina ao domínio (neste momento utilizando o kerberos)<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/6-test_kerberos_autentication.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/6-test_kerberos_autentication.png" alt="" title="6-test_kerberos_autentication" width="1024" height="768" class="alignright size-full wp-image-774" /></a><br /><br />net ads join -U Administrador<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/7-join_ads_domain.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/7-join_ads_domain.png" alt="" title="7-join_ads_domain" width="1024" height="768" class="alignright size-full wp-image-775" /></a><br /></li><br />	<li>Adicionar a máquina ao domínio (agora utilizando o samba): no yast use a opção:"Participação no domínio do windows", marcando a opção "Usar informação SMB para autenticação Linux"<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/8-windows_domain_membership.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/8-windows_domain_membership.png" alt="" title="8-windows_domain_membership" width="1024" height="768" class="alignright size-full wp-image-776" /></a><br /></li><br /><li>Reinicie a máquina<br /><a href="http://blog.gilbertoca.com/wp-content/uploads/9-reboot_linux_client.png"><img src="http://blog.gilbertoca.com/wp-content/uploads/9-reboot_linux_client.png" alt="" title="9-reboot_linux_client" width="1024" height="768" class="alignright size-full wp-image-777" /></a><br /></li><br /></ol><br /><br />Use com moderação! :)