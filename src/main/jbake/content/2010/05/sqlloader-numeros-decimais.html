title=SQL*Loader - Números decimais
date=2010-05-31
type=post
tags=linux,banco-de-dados,oracle
status=published
~~~~~~

<p><br /><blockquote>Verificando posts de <a href="http://www.jroller.com/gilbertoca">meu antigo blog</a> notei que alguns não foram importados ou foram importados com defeitos em seu conteúdo. Então resolvi realizar um trabalho de revisão e o <strong><a href="http://www.jroller.com/gilbertoca/entry/sql_load_n%C3%BAmeros_decimais">segundo</a></strong> começa hoje:<br /></blockquote><br /></p><br /><p><br />Se burrice matasse, já estária morto! Calma vou explicar. Estou fazendo carga de um sistema legado (migração). E algumas tabelas contém colunas com o <a href="http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements001.htm#SQLRF00222">tipo de dado NUMBER</a>(15,6), mas os dados podem vir nulos, inteiros ou decimais.<br />Inicialmente pensei que ele (<a href="http://download.oracle.com/docs/cd/B19306_01/server.102/b14215/part_ldr.htm#g996849">sqlldr</a>) faria a conversão, mas ..<br /><pre lang="sql"><br />Record 1: Rejected - Error on table VANTAGENS_TMP, column VALOR.<br />ORA-01722: invalid number<br />Record 2: Rejected - Error on table VANTAGENS_TMP, column VALOR.<br />ORA-01722: invalid number<br /></pre><br /></p><br /><p><br />Depois tentei colocar <a href="http://download.oracle.com/docs/cd/B19306_01/server.102/b14215/ldr_field_list.htm">tipos específicos no control file</a> para estas colunas, como por exemplo <a href="http://download.oracle.com/docs/cd/B19306_01/server.102/b14215/ldr_field_list.htm#sthref948">INTEGER, INTEGER EXTERNAL, DECIMAL(15,6)</a>. Mas todas as tentativas acabavam com:<br /><pre lang="sql"><br />Record 29: Rejected - Error on table VANTAGENS_TMP, column VALOR.<br />ORA-01460: unimplemented or unreasonable conversion requested<br /></pre><br /></p><br /><p><br />A solução, foi tão simples que estou até com vergonha de dizer. Bom, praticamente todas as atividades que você faz através de uma sessão sql, são regidas pela <a href="http://download.oracle.com/docs/cd/B19306_01/install.102/b25149/app_gblsupp.htm#sthref469">variável de ambiente NLS_LANG</a>. Pois é, você ajusta esta variável e todas que dependem dela, quer dizer, NLS_* vão assumir valores pre-definidos. Aí você fala: Qual é a novidade? A novidade é que se você fizer uma customização em qualquer uma das <a href="http://download.oracle.com/docs/cd/B19306_01/server.102/b14225/ch3globenv.htm#sthref316">outras variáveis</a> (que foi o caso do bonitão aqui), você terá que assumir as consequências. Enquanto estava fazendo um teste com procedimento ajustei uma destas variáveis:<br /><pre lang="bash"><br />export NLS_NUMERIC_CHARACTERS=,.<br /></pre><br /></p><br /><p><br />Bom, foi só trocar os sinais que conversão implícita funcionou. Mas uma coisa, uma dica é colocar o tipo do character set no <a href="http://download.oracle.com/docs/cd/B19306_01/server.102/b14215/ldr_control_file.htm#i1006645">control file</a> através do parametro CHARACTERSET, assim você não depende da configuração do ambiente para fazer carga.<br /></p>